# ## 背景

**プロジェクト**: `/Users/arigatatsuya/Work/git/github.com/sk8metalme/ai-agent-setup`

**日時**: 2026-01-31T23:35:35.420Z

---

## 背景

daily-knowledge-sync スキルで、リポジトリパスのデコードに失敗する問題が発生しています。

### 問題の詳細

**エンコーディング方式（Claude Code CLI）**:
- `/` → `-`
- `.` → `-`

**例**:
```
元: /Users/arigatatsuya/Work/git/github.com/sk8metalme/ai-agent-setup
エンコード: -Users-arigatatsuya-Work-git-github-com-sk8metalme-ai-agent-setup
```

**問題**: このエンコーディングは非可逆（情報損失）
- 元のファイル名に `-` が含まれる場合（`ai-agent-setup`）
- 元のパスに `.` が含まれる場合（`github.com`）
- 両方とも `-` に変換されるため、区別不能

**現在のコード（失敗例）**:
```bash
# Base64 デコードを試みたが失敗（Base64ではない）
decoded=$(basename "$dir_part" | base64 -d 2>/dev/null || echo "")

# 単純な `-` → `/` 置換も失敗
echo "$dir" | tr '-' '/'
# 結果: Users/arigatatsuya/Work/git/github/com/sk8metalme/ai/agent/setup
# 期待: /Users/arigatatsuya/Work/git/github.com/sk8metalme/ai-agent-setup
```

### 関連ファイル

1. `/Users/arigatatsuya/.claude/plugins/cache/ai-agent-setup/daily-knowledge-sync/1.6.1/skills/daily-knowledge-sync/scripts/extract_knowledge.py`
   - source_file フィールドに JSONL の絶対パスをそのまま保存
   - デコード処理なし

2. `/Users/arigatatsuya/.claude/plugins/cache/ai-agent-setup/daily-knowledge-sync/1.6.1/skills/daily-knowledge-sync/SKILL.md`
   - Step 11-1 の日次まとめで、リポジトリ一覧を表示

### 要件

1. エンコードされたプロジェクトディレクトリ名から元のパスを正しく復元
2. 再発防止（堅牢なデコード処理の実装）
3. 既存の出力フォーマット（日次まとめ）を維持

### 解決策の検討

**案A: ファイルシステム照合によるデコード**
- エンコード名を再帰的に解析し、存在するパスを見つける
- pros: 確実にデコード可能
- cons: 複雑、パフォーマンス懸念

**案B: extract_knowledge.py で元パスを保存**
- JSONL ファイルのメタデータから元のプロジェクトパスを取得
- 候補 JSON に `project_path` フィールドを追加
- pros: シンプル、一度の処理で済む
- cons: JSONL にメタデータがあるか要確認

**案C: プロジェクトマッピングテーブルの事前構築**
- `~/.claude/projects/` を走査してマッピングを作成
- pros: 効率的（一度だけ構築）
- cons: 追加のストレージ/ロジック

**案D: エンコード名をそのまま使用**
- 日次まとめではエンコード名を識別子として表示
- pros: 最もシンプル
- cons: ユーザー可読性が低い

### タスク

以下を設計してください：
1. 推奨する解決策とその理由
2. 実装計画（どのファイルをどう修正するか）
3. テスト方法
